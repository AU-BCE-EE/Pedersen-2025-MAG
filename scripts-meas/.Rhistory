setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/data-emission/scripts")
# Download latest ALFAM2 data, subset to this study, and save copy
rm(list = ls())
source('packages.R')
source('load.R')
source('subset.R')
source('export.R')
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/scripts-meas")
rm(list = ls())
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/scripts-meas")
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
library(ggplot2)
# library(lubridate)
# library(viridisLite)
# library(knitr)
# library(rmarkdown)
# library(gridExtra)
sink('../logs/R-versions-meas.txt')
print(sessionInfo())
sink()
# Add trial keys and names for plots
tk <- c(`22C` = 'A', `22D` = 'B', `22G` = 'C')
pdat$trial <- tk[pdat$app.date]
View(pdat)
# Add trial keys and names for plots
tk <- c('22C' = 'A', '22D' = 'B', '22G' = 'C')
pdat$trial <- tk[pdat$app.date]
# Add trial keys and names for plots
tk <- c('22C' = 'A', '22D' = 'B', '22G' = 'C', '22H' = 'D', '22I' = 'E')
pdat$trial <- tk[pdat$app.date]
# Add trial keys and names for plots
tk <- c(`22C` = 'A', `22D` = 'B', `22G` = 'C', `22H` = 'D', `22I` = 'E')
pdat$trial <- tk[pdat$app.date]
# Add trial keys and names for plots
tk <- c(`22C` = 'A', `22D` = 'B', `22G` = 'C', `22H` = 'D', `22I` = 'E')
pdat$trial <- tk[pdat$exper]
# Add trial keys and names for plots
tk <- c(`22C` = 'A', `22D` = 'B', `22G` = 'C', `22H` = 'D', `22I` = 'E')
pdat$trial <- tk[pdat$exper]
tk <- c('22C' = 'A', '22D' = 'B', '22G' = 'C', '22H' = 'D', '22I' = 'E')
pdat$trial <- tk[pdat$exper]
tk[pdat$exper]
tk
# Add trial keys and names for plots
tk <- c(`22C` = 'A', `22D` = 'B', `22G` = 'C', `22H` = 'D', `22I` = 'E')
tk
# Add trial keys and names for plots
tk <- c(`22C` = 'A', `22D` = 'B', `22G` = 'C', `22H` = 'D', `22I` = 'E')
pdat$trial <- tk[pdat$exper]
pdat$exper
tk <- c('22C' = 'A', '22D' = 'B', '22G' = 'C', '22H' = 'D', '22I' = 'E')
tk[pdat$exper]
# Add trial keys and names for plots
tk <- c(`22C` = 'A', `22D` = 'B', `22G` = 'C', `22H` = 'D', `22I` = 'E')
tk[pdat$exper]
pdat$exper
tk
header(tk)
tk <- as.character(tk)
pdat$trial <- tk[pdat$exper]
pdat$trial
tk <- c(22C = 'A', 22D = 'B', 22G = 'C', 22H = 'D', 22I = 'E')
tk <- c('22C' = 'A', '22D' = 'B', '22G' = 'C', '22H' = 'D', '22I' = 'E')
tk
pdat$trial <- pdat$exper
test <- mutate(trial = recode(trial, '22C' = 'A', '22D' = 'B', '22G' = 'C', '22H' = 'D', '22I' = 'E'))
?mutate
library(dplyr)
pdat$trial <- pdat$exper
test <- mutate(trial = recode(trial, '22C' = 'A', '22D' = 'B', '22G' = 'C', '22H' = 'D', '22I' = 'E'))
pdat <- mutate(pdat$exper = recode(pdat$exper, '22C' = 'A', '22D' = 'B', '22G' = 'C', '22H' = 'D', '22I' = 'E'))
pdat <- mutate(pdat$exper, recode(pdat$exper, '22C' = 'A', '22D' = 'B', '22G' = 'C', '22H' = 'D', '22I' = 'E'))
pdat$trial <- as.factor(pdat$exper)
pdat <- mutate(pdat$exper, recode(pdat$exper, '22C' = 'A', '22D' = 'B', '22G' = 'C', '22H' = 'D', '22I' = 'E'))
pdat$trial <- as.factor(pdat$exper)
pdat$exper[pdat$exper == c('22C', '22D', '22G', '22H', '22H', '22I')] <- c('A', 'B', 'C', 'D', 'E')
pdat$trial <- pdat$exper
pdat$trial <- gsub('22C', 'A', pdat$trial)
pdat$trial <- as.factor(pdat$exper)
pdat <- mutate(pdat$exper, recode(pdat$exper, '23C' = 'A', '23D' = 'B', '23G' = 'C', '23H' = 'D', '23I' = 'E'))
pdat$trial <- tk[pdat$exper]
pdat$trial
pdat$trial <- as.factor(pdat$exper)
pdat <- mutate(pdat$exper, recode(pdat$exper, '23C' = 'A', '23D' = 'B', '23G' = 'C', '23H' = 'D', '23I' = 'E'))
pdat$trial <- tk[pdat$trial]
tk <- c(`23C` = 'A', `23D` = 'B', `23G` = 'C', `23H` = 'D', `23I` = 'E')
tk
pdat$trial <- tk[pdat$app.date]
pdat$trial <- tk[pdat$exper]
idat$trial <- tk[idat$exper]
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('clean.R')
View(idat)
isumm <- idat[, list(cta = max(cta),
air.temp.mean = mean(air.temp),
air.temp.min = min(air.temp),
air.temp.max = max(air.temp),
wind.2m.mean = mean(wind.2m),
wind.2m.min = min(wind.2m),
wind.2m.max = max(wind.2m),
rain.cum = max(rain.cum),
rain.cum.168 = max(rain.cum * (cta <= 168)),
rain.cum.24 = max(rain.cum * (cta <= 24)),
rain.cum.48 = max(rain.cum * (cta <= 48)),
j.NH3.mean = mean(j.NH3),
j.NH3.min = min(j.NH3),
j.NH3.max = max(j.NH3),
e.cum.final = max(e.cum),
e.cum.final.gaps = sum(e.int[!grepl('i', flag.int)]),
e.rel.final = max(e.rel),
e.cum.168 = approx(cta, e.cum, xout = 168)$y,
e.rel.168 = approx(cta, e.rel, xout = 168)$y,
e.cum.168.sum = sum(e.int[cta <= 168]),
e.cum.168.gaps = sum(e.int[cta <= 168 & !grepl('i', flag.int)]),
n.int.168 = length(e.int[cta <= 168]),
n.int.168.gaps = length(e.int[cta <= 168 & !grepl('i', flag.int)])
), by = list(trial.nm, app.date, pmid, meas.tech, meas.tech2, aer, aer.grp)]
View(pdat)
# Mean and sd of cumulative emission
esumm <- isumm[ , list(
pmid = paste(pmid, collapse = ', '),
e.rel.final = mean(e.rel.final), e.rel.final.n = length(e.rel.final), e.rel.final.sd = sd(e.rel.final),
e.rel.168 = mean(e.rel.168), e.rel.168.n = length(e.rel.168), e.rel.168.sd = sd(e.rel.168),
e.cum.final = mean(e.cum.final), e.cum.final.gaps = mean(e.cum.final.gaps),
e.cum.168.sum = mean(e.cum.168.sum), e.cum.168.gaps = mean(e.cum.168.gaps),
n.int.168 = mean(n.int.168), n.int.168.gaps = mean(n.int.168.gaps)
),
by = list(trial, app.date, treat)]
# Mean and sd of cumulative emission
esumm <- isumm[ , list(
pmid = paste(pmid, collapse = ', '),
e.rel.final = mean(e.rel.final), e.rel.final.n = length(e.rel.final), e.rel.final.sd = sd(e.rel.final),
e.rel.168 = mean(e.rel.168), e.rel.168.n = length(e.rel.168), e.rel.168.sd = sd(e.rel.168),
e.cum.final = mean(e.cum.final), e.cum.final.gaps = mean(e.cum.final.gaps),
e.cum.168.sum = mean(e.cum.168.sum), e.cum.168.gaps = mean(e.cum.168.gaps),
n.int.168 = mean(n.int.168), n.int.168.gaps = mean(n.int.168.gaps)
),
by = list(trial, app.date, treat)]
isumm <- idat[, list(cta = max(cta),
air.temp.mean = mean(air.temp),
air.temp.min = min(air.temp),
air.temp.max = max(air.temp),
j.NH3.mean = mean(j.NH3),
j.NH3.min = min(j.NH3),
j.NH3.max = max(j.NH3),
e.cum.final = max(e.cum),
e.cum.final.gaps = sum(e.int[!grepl('i', flag.int)]),
e.rel.final = max(e.rel),
e.cum.168 = approx(cta, e.cum, xout = 168)$y,
e.rel.168 = approx(cta, e.rel, xout = 168)$y,
e.cum.168.sum = sum(e.int[cta <= 168]),
e.cum.168.gaps = sum(e.int[cta <= 168 & !grepl('i', flag.int)]),
n.int.168 = length(e.int[cta <= 168]),
n.int.168.gaps = length(e.int[cta <= 168 & !grepl('i', flag.int)])
), by = list(trial, app.date, pmid, )]
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/scripts-meas")
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('clean.R')
isumm <- idat[, list(cta = max(cta),
air.temp.mean = mean(air.temp),
air.temp.min = min(air.temp),
air.temp.max = max(air.temp),
j.NH3.mean = mean(j.NH3),
j.NH3.min = min(j.NH3),
j.NH3.max = max(j.NH3),
e.cum.final = max(e.cum),
e.cum.final.gaps = sum(e.int[!grepl('i', flag.int)]),
e.rel.final = max(e.rel),
e.cum.168 = approx(cta, e.cum, xout = 168)$y,
e.rel.168 = approx(cta, e.rel, xout = 168)$y,
e.cum.168.sum = sum(e.int[cta <= 168]),
e.cum.168.gaps = sum(e.int[cta <= 168 & !grepl('i', flag.int)]),
n.int.168 = length(e.int[cta <= 168]),
n.int.168.gaps = length(e.int[cta <= 168 & !grepl('i', flag.int)])
), by = list(trial, app.date, pmid, )]
isumm <- idat[, list(cta = max(cta),
air.temp.mean = mean(air.temp),
air.temp.min = min(air.temp),
air.temp.max = max(air.temp),
j.NH3.mean = mean(j.NH3),
j.NH3.min = min(j.NH3),
j.NH3.max = max(j.NH3),
e.cum.final = max(e.cum),
e.cum.final.gaps = sum(e.int[!grepl('i', flag.int)]),
e.rel.final = max(e.rel),
e.cum.168 = approx(cta, e.cum, xout = 168)$y,
e.rel.168 = approx(cta, e.rel, xout = 168)$y,
e.cum.168.sum = sum(e.int[cta <= 168]),
e.cum.168.gaps = sum(e.int[cta <= 168 & !grepl('i', flag.int)]),
n.int.168 = length(e.int[cta <= 168]),
n.int.168.gaps = length(e.int[cta <= 168 & !grepl('i', flag.int)])
), by = list(trial, treat, pmid, )]
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
# Add trial keys and names for plots
tk <- c(`23C` = 'A', `23D` = 'B', `23G` = 'C', `23H` = 'D', `23I` = 'E')
pdat$trial <- tk[pdat$exper]
idat$trial <- tk[idat$exper]
# Merge in plot level variables
idat <- merge(pdat, idat, by = c('pid', 'pmid'))
isumm <- idat[, list(cta = max(cta),
air.temp.mean = mean(air.temp),
air.temp.min = min(air.temp),
air.temp.max = max(air.temp),
j.NH3.mean = mean(j.NH3),
j.NH3.min = min(j.NH3),
j.NH3.max = max(j.NH3),
e.cum.final = max(e.cum),
e.cum.final.gaps = sum(e.int[!grepl('i', flag.int)]),
e.rel.final = max(e.rel),
e.cum.168 = approx(cta, e.cum, xout = 168)$y,
e.rel.168 = approx(cta, e.rel, xout = 168)$y,
e.cum.168.sum = sum(e.int[cta <= 168]),
e.cum.168.gaps = sum(e.int[cta <= 168 & !grepl('i', flag.int)]),
n.int.168 = length(e.int[cta <= 168]),
n.int.168.gaps = length(e.int[cta <= 168 & !grepl('i', flag.int)])
), by = list(trial, treat, pmid, )]
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('subset.R')
# Add trial keys and names for plots
tk <- c(`23C` = 'A', `23D` = 'B', `23G` = 'C', `23H` = 'D', `23I` = 'E')
pdat$trial <- tk[pdat$exper]
idat$trial <- tk[idat$exper]
# Merge in plot level variables
idat <- merge(pdat, idat, by = c('pid', 'pmid'))
# Merge in plot level variables
idat <- merge(pdat, idat, by = c('pid', 'pmid'))
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('subset.R')
