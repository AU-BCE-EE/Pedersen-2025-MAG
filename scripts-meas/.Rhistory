ggsave2x('../plots-meas/scatter', height = 4.5, width = 6)
ggsave2x('../plots-meas/scatter', height = 5, width = 6.5)
ggplot(ds_long, aes(value, e.rel.150, colour = dig1)) +
geom_point(shape = 21, fill = 'white', size = 4.5) +
geom_text(aes(label = trial.ID), show.legend = FALSE) +
facet_wrap(~ new.names, scales = 'free_x', ncol = 2) +
scale_colour_manual(values = cols) +
labs(y = 'Relative emission (% TAN)', colour = '') +
theme_bw() +
theme(axis.title.x = element_blank()) +
theme(legend.position = 'top')
ggsave2x('../plots-meas/scatter', height = 7.5, width = 6.5)
ggsave2x('../plots-meas/scatter', height = 7.5, width = 5.5)
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2025-MAG/scripts-meas")
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('subset.R')
source('D3_times.R')
source('summary.R')
#render('stats.Rmd', output_file = '../stats-meas/stats.pdf')
source('export.R')
idat.treat <- idat[is.element(idat$new.ID, c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12')), ]
idat.prop <- idat[is.element(idat$new.ID, c('D1', 'D2', 'D3', 'D4', 'D5')), ]
fsumm.treat <- fsumm[is.element(fsumm$new.ID, c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12')), ]
# flux over time
# all:
ggplot(idat, aes(cta, j.NH3, group = pmid, color = treat1)) +
geom_point() +
facet_wrap(~ new.ID) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
fsumm.treat01 <- fsumm.treat[fsumm.treat$new.ID == '1' | fsumm.treat$new.ID == '2' | fsumm.treat$new.ID == '3' | fsumm.treat$new.ID == '4', ]
fsumm.treat01 <- fsumm.treat01[! c(fsumm.treat01$new.ID == '3' & fsumm.treat01$treat1 == 'B Sep-S' & fsumm.treat01$cta == '0'), ]
# Create and sort factor for plot labels
setorder(fsumm.treat01, new.ID, treat1)
ll <- unique(fsumm.treat01[, treat1])
labs <- data.table(treat1 = ll, i = as.integer(factor(ll, levels = ll)))
labs[, leg.lab := paste0(i, '. ', treat1)]
fsumm.treat01[, tfact := factor(treat1, levels = ll)]
fsumm.treat01[, leg.lab := factor(paste0(as.integer(tfact), '. ', tfact), levels = labs$leg.lab)]
# Manual adjustments to avoid overplotting
adj <- data.table(i      = c(4,           6,      9,     1,      4,     7, 11, 10),
new.ID = c(1,           2,      2,     3,      4,     3, 3, 3),
yshift = c(-0.002, -0.003, -0.002, 0.003, -0.001, 0.001, -0.003, -0.002))
adj[, new.ID := as.character(new.ID)]
# Get integer codes and initial emission
d0 <- fsumm.treat01[, .(y = j.rel.mn[cta == min(cta)]), by = .(new.ID, leg.lab)]
labs <- merge(labs, d0)
labs <- merge(labs, adj, all = TRUE, by = c('i', 'new.ID'))
labs[is.na(yshift), yshift := 0]
labs[, y := y + yshift]
f1 <- ggplot(fsumm.treat01, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 3.2, show.legend = FALSE) +
facet_wrap(~ new.ID, ncol = 4) +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
guides(colour = guide_legend(nrow = 3, byrow = TRUE)) +
xlim(-2, 150)
f11 <- ggplot(fsumm.treat01, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 3.2, show.legend = FALSE) +
facet_wrap(~ new.ID, ncol = 4) +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
guides(colour = guide_legend(nrow = 3, byrow = TRUE)) +
xlim(-0.2, 50)
fsumm.treat02 <- fsumm.treat[fsumm.treat$new.ID == '5' | fsumm.treat$new.ID == '6' | fsumm.treat$new.ID == '7' | fsumm.treat$new.ID == '8', ]
f2 <- ggplot(fsumm.treat02, aes(cta, j.rel.mn, color = treat1, fill = treat1)) +
geom_point(shape = 1, size = 0.5) + geom_line() +
facet_wrap(~ new.ID, ncol = 4) +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
ylim(NA, 0.025) +
xlim(NA, 150)
f22 <- ggplot(fsumm.treat02, aes(cta, j.rel.mn, color = treat1, fill = treat1)) +
geom_point(shape = 1, size = 0.5) + geom_line() +
facet_wrap(~ new.ID, ncol = 4) +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
ylim(NA, 0.025) +
xlim(NA, 50)
fsumm.treat03 <- fsumm.treat[fsumm.treat$new.ID == '9' | fsumm.treat$new.ID == '10' | fsumm.treat$new.ID == '11' | fsumm.treat$new.ID == '12', ]
fsumm.treat03 <- fsumm.treat03[! fsumm.treat03$treat == 'TH-4', ]
fsumm.treat03 <- fsumm.treat03[! fsumm.treat03$treat == 'TS1-4', ]
fsumm.treat03 <- fsumm.treat03[! fsumm.treat03$treat == 'TS1 + acid', ]
fsumm.treat03$new.ID.f <- factor(fsumm.treat03$new.ID, levels = c('9', '10', '11', '12'))
f3 <- ggplot(fsumm.treat03, aes(cta, j.rel.mn, color = treat1, fill = treat1)) +
geom_point(shape = 1, size = 0.5) + geom_line() +
facet_wrap(~ new.ID.f, ncol = 4) +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
ylim(NA, 0.075) +
xlim(NA, 150)
f33 <- ggplot(fsumm.treat03, aes(cta, j.rel.mn, color = treat1, fill = treat1)) +
geom_point(shape = 1, size = 0.5) + geom_line() +
facet_wrap(~ new.ID.f, ncol = 4) +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
ylim(NA, 0.075) +
xlim(NA, 50)
mat <- matrix(c(1, 1, 1, 1,
2, 2, 2,
3, 3, 3),
ncol = 1)
pff <- grid.arrange(f1, f2, f3, layout_matrix = mat)
fsumm.prop <- fsumm[is.element(fsumm$new.ID, c('D1', 'D2', 'D3', 'D4', 'D5')), ]
# Create and sort factor for plot labels
setorder(fsumm.prop, new.ID, treat1)
ll <- unique(fsumm.prop[, treat1])
labs <- data.table(treat1 = ll, i = as.integer(factor(ll, levels = ll)))
labs[, leg.lab := paste0(i, '. ', treat1)]
fsumm.prop[, tfact := factor(treat1, levels = ll)]
fsumm.prop[, leg.lab := factor(paste0(as.integer(tfact), '. ', tfact), levels = labs$leg.lab)]
# Manual adjustments to avoid overplotting
adj <- data.table(i      = c(1, 2, 3, 4, 5, 1, 6, 7, 8, 9, 1, 3, 8, 10, 11, 1, 6, 7, 12, 13, 1, 2, 4, 14, 15),
new.ID = c('D1', 'D1', 'D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D2', 'D2',
'D3', 'D3', 'D3', 'D3', 'D3', 'D4', 'D4', 'D4', 'D4', 'D4',
'D5', 'D5', 'D5', 'D5', 'D5'),
yshift = c(-0.003, -0.003, -0.003, 0.002, 0.003, -0.002, -0.005, 0.002, 0, 0,
0.001, 0.001, 0.00, 0, 0, -0.0002, 0, 0, 0, 0, -0.001, -0.001, 0.003, 0, 0))
adj[, new.ID := as.character(new.ID)]
# Get integer codes and initial emission
d0 <- fsumm.prop[, .(y = j.rel.mn[cta == min(cta)]), by = .(new.ID, leg.lab)]
labs <- merge(labs, d0)
labs <- merge(labs, adj, all = TRUE, by = c('i', 'new.ID'))
labs[is.na(yshift), yshift := 0]
labs[, y := y + yshift]
# define new labels for each subplot (Tral X instead of DX)
custom_labels <- c(
'D1' = 'Trial 1',
'D2' = 'Trial 2',
'D3' = 'Trial 3',
'D4' = 'Trial 4',
'D5' = 'Trial 5'
)
ggplot(fsumm.prop, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 4.2, show.legend = FALSE) +
facet_wrap(~ new.ID, labeller = labeller(new.ID = custom_labels), ncol = 1, scale = 'free_y') +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
guides(color = guide_legend(nrow = 5)) +
xlim(-0.02, 52)
cols15 <- c(
"#1B9E77", "#D95F02", "#7570B3",  # your original 3
"#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666",
"#1F78B4", "#B2DF8A", "#FB9A99", "#FDBF6F",
"#CAB2D6", "#6A3D9A", "#FF7F00"
)
ggplot(fsumm.prop, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 4.2, show.legend = FALSE) +
facet_wrap(~ new.ID, labeller = labeller(new.ID = custom_labels), ncol = 1, scale = 'free_y') +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
scale_colour_manual(values = cols15) +
guides(color = guide_legend(nrow = 5)) +
xlim(-0.02, 52)
ggplot(fsumm.prop, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 4.2, show.legend = FALSE) +
facet_wrap(~ new.ID, labeller = labeller(new.ID = custom_labels), ncol = 1, scale = 'free_y') +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
scale_colour_manual(values = cols15) +
scale_fill_manual(values = cols15) +
guides(color = guide_legend(nrow = 5)) +
xlim(-0.02, 52)
ggplot(fsumm.prop, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 4.2, show.legend = FALSE) +
facet_wrap(~ new.ID, labeller = labeller(new.ID = custom_labels), ncol = 1, scale = 'free_y') +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat1), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
scale_colour_manual(values = cols15) +
scale_fill_manual(values = cols15) +
guides(color = guide_legend(nrow = 3)) +
xlim(-0.02, 150)
View(idat.prop)
View(fsumm.prop)
treat2 <- c(`A` =  'Digestate A',
`B` =  'Digestate B',
`C` =  'Digestate C',
`D` =  'Digestate D',
`E` =  'Digestate E',
`F` =  'Digestate F',
`G` =  'Digestate G',
`H` =  'Digestate H',
`I` =  'Digestate I')
fsumm.prop[, treat2 := treat2[treat1]]
setorder(fsumm.prop, new.ID, treat1)
ll <- unique(fsumm.prop[, treat1])
labs <- data.table(treat1 = ll, i = as.integer(factor(ll, levels = ll)))
labs[, leg.lab := paste0(i, '. ', treat1)]
fsumm.prop[, tfact := factor(treat1, levels = ll)]
setorder(fsumm.prop, new.ID, treat2)
ll <- unique(fsumm.prop[, treat2])
labs <- data.table(treat2 = ll, i = as.integer(factor(ll, levels = ll)))
labs[, leg.lab := paste0(i, '. ', treat2)]
fsumm.prop[, tfact := factor(treat2, levels = ll)]
fsumm.prop[, leg.lab := factor(paste0(as.integer(tfact), '. ', tfact), levels = labs$leg.lab)]
# Manual adjustments to avoid overplotting
adj <- data.table(i      = c(1, 2, 3, 4, 5, 1, 6, 7, 8, 9, 1, 3, 8, 10, 11, 1, 6, 7, 12, 13, 1, 2, 4, 14, 15),
new.ID = c('D1', 'D1', 'D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D2', 'D2',
'D3', 'D3', 'D3', 'D3', 'D3', 'D4', 'D4', 'D4', 'D4', 'D4',
'D5', 'D5', 'D5', 'D5', 'D5'),
yshift = c(-0.003, -0.003, -0.003, 0.002, 0.003, -0.002, -0.005, 0.002, 0, 0,
0.001, 0.001, 0.00, 0, 0, -0.0002, 0, 0, 0, 0, -0.001, -0.001, 0.003, 0, 0))
adj[, new.ID := as.character(new.ID)]
# Get integer codes and initial emission
d0 <- fsumm.prop[, .(y = j.rel.mn[cta == min(cta)]), by = .(new.ID, leg.lab)]
labs <- merge(labs, d0)
labs <- merge(labs, adj, all = TRUE, by = c('i', 'new.ID'))
labs[is.na(yshift), yshift := 0]
labs[, y := y + yshift]
# define new labels for each subplot (Tral X instead of DX)
custom_labels <- c(
'D1' = 'Trial 1',
'D2' = 'Trial 2',
'D3' = 'Trial 3',
'D4' = 'Trial 4',
'D5' = 'Trial 5'
)
cols15 <- c(
"#1B9E77", "#D95F02", "#7570B3",  # your original 3
"#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666",
"#1F78B4", "#B2DF8A", "#FB9A99", "#FDBF6F",
"#CAB2D6", "#6A3D9A", "#FF7F00"
)
ggplot(fsumm.prop, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 4.2, show.legend = FALSE) +
facet_wrap(~ new.ID, labeller = labeller(new.ID = custom_labels), ncol = 1, scale = 'free_y') +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat2), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
scale_colour_manual(values = cols15) +
scale_fill_manual(values = cols15) +
guides(color = guide_legend(nrow = 5)) +
xlim(-0.02, 52)
treat2 <- c(`A` =  'Digestate A',
`B` =  'Digestate B',
`C` =  'Digestate C',
`D` =  'Digestate D',
`E` =  'Digestate E',
`F` =  'Digestate F',
`G` =  'Digestate G',
`H` =  'Digestate H',
`I` =  'Digestate I',
`Cattle A` =  'Cattle A',
`Cattle B` =  'Cattle B',
`Cattle C` =  'Cattle C',
`Pig A` =  'Pig A',
`Pig B` =  'Pig B',
`Pig C` =  'Pig C',
)
treat2 <- c(`A` =  'Digestate A',
`B` =  'Digestate B',
`C` =  'Digestate C',
`D` =  'Digestate D',
`E` =  'Digestate E',
`F` =  'Digestate F',
`G` =  'Digestate G',
`H` =  'Digestate H',
`I` =  'Digestate I',
`Cattle A` =  'Cattle A',
`Cattle B` =  'Cattle B',
`Cattle C` =  'Cattle C',
`Pig A` =  'Pig A',
`Pig B` =  'Pig B',
`Pig C` =  'Pig C')
fsumm.prop[, treat2 := treat2[treat1]]
setorder(fsumm.prop, new.ID, treat2)
ll <- unique(fsumm.prop[, treat2])
labs <- data.table(treat2 = ll, i = as.integer(factor(ll, levels = ll)))
labs[, leg.lab := paste0(i, '. ', treat2)]
fsumm.prop[, tfact := factor(treat2, levels = ll)]
fsumm.prop[, leg.lab := factor(paste0(as.integer(tfact), '. ', tfact), levels = labs$leg.lab)]
# Manual adjustments to avoid overplotting
adj <- data.table(i      = c(1, 2, 3, 4, 5, 1, 6, 7, 8, 9, 1, 3, 8, 10, 11, 1, 6, 7, 12, 13, 1, 2, 4, 14, 15),
new.ID = c('D1', 'D1', 'D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D2', 'D2',
'D3', 'D3', 'D3', 'D3', 'D3', 'D4', 'D4', 'D4', 'D4', 'D4',
'D5', 'D5', 'D5', 'D5', 'D5'),
yshift = c(-0.003, -0.003, -0.003, 0.002, 0.003, -0.002, -0.005, 0.002, 0, 0,
0.001, 0.001, 0.00, 0, 0, -0.0002, 0, 0, 0, 0, -0.001, -0.001, 0.003, 0, 0))
adj[, new.ID := as.character(new.ID)]
# Get integer codes and initial emission
d0 <- fsumm.prop[, .(y = j.rel.mn[cta == min(cta)]), by = .(new.ID, leg.lab)]
labs <- merge(labs, d0)
labs <- merge(labs, adj, all = TRUE, by = c('i', 'new.ID'))
labs[is.na(yshift), yshift := 0]
labs[, y := y + yshift]
# define new labels for each subplot (Tral X instead of DX)
custom_labels <- c(
'D1' = 'Trial 1',
'D2' = 'Trial 2',
'D3' = 'Trial 3',
'D4' = 'Trial 4',
'D5' = 'Trial 5'
)
cols15 <- c(
"#1B9E77", "#D95F02", "#7570B3",  # your original 3
"#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666",
"#1F78B4", "#B2DF8A", "#FB9A99", "#FDBF6F",
"#CAB2D6", "#6A3D9A", "#FF7F00"
)
ggplot(fsumm.prop, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 4.2, show.legend = FALSE) +
facet_wrap(~ new.ID, labeller = labeller(new.ID = custom_labels), ncol = 1, scale = 'free_y') +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat2), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
scale_colour_manual(values = cols15) +
scale_fill_manual(values = cols15) +
guides(color = guide_legend(nrow = 5)) +
xlim(-0.02, 52)
fsumm.prop <- fsumm[is.element(fsumm$new.ID, c('D1', 'D2', 'D3', 'D4', 'D5')), ]
treat2 <- c(`A` =  'Digestate A',
`B` =  'Digestate B',
`C` =  'Digestate C',
`D` =  'Digestate D',
`E` =  'Digestate E',
`F` =  'Digestate F',
`G` =  'Digestate G',
`H` =  'Digestate H',
`I` =  'Digestate I',
`Cattle A` =  'Cattle A',
`Cattle B` =  'Cattle B',
`Cattle C` =  'Cattle C',
`Pig A` =  'Pig A',
`Pig B` =  'Pig B',
`Pig C` =  'Pig C')
fsumm.prop[, treat2 := treat2[treat1]]
setorder(fsumm.prop, new.ID, treat2)
ll <- unique(fsumm.prop[, treat2])
labs <- data.table(treat2 = ll, i = as.integer(factor(ll, levels = ll)))
labs[, leg.lab := paste0(i, '. ', treat2)]
fsumm.prop[, tfact := factor(treat2, levels = ll)]
fsumm.prop[, leg.lab := factor(paste0(as.integer(tfact), '. ', tfact), levels = labs$leg.lab)]
# Manual adjustments to avoid overplotting
adj <- data.table(i      = c(1, 2, 3, 4, 5, 1, 6, 7, 8, 9, 1, 3, 8, 10, 11, 1, 6, 7, 12, 13, 1, 2, 4, 14, 15),
new.ID = c('D1', 'D1', 'D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D2', 'D2',
'D3', 'D3', 'D3', 'D3', 'D3', 'D4', 'D4', 'D4', 'D4', 'D4',
'D5', 'D5', 'D5', 'D5', 'D5'),
yshift = c(-0.003, -0.003, -0.003, 0.002, 0.003, -0.002, -0.005, 0.002, 0, 0,
0.001, 0.001, 0.00, 0, 0, -0.0002, 0, 0, 0, 0, -0.001, -0.001, 0.003, 0, 0))
adj[, new.ID := as.character(new.ID)]
# Get integer codes and initial emission
d0 <- fsumm.prop[, .(y = j.rel.mn[cta == min(cta)]), by = .(new.ID, leg.lab)]
labs <- merge(labs, d0)
labs <- merge(labs, adj, all = TRUE, by = c('i', 'new.ID'))
labs[is.na(yshift), yshift := 0]
labs[, y := y + yshift]
# define new labels for each subplot (Tral X instead of DX)
custom_labels <- c(
'D1' = 'Trial 1',
'D2' = 'Trial 2',
'D3' = 'Trial 3',
'D4' = 'Trial 4',
'D5' = 'Trial 5'
)
cols15 <- c(
"#1B9E77", "#D95F02", "#7570B3",  # your original 3
"#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666",
"#1F78B4", "#B2DF8A", "#FB9A99", "#FDBF6F",
"#CAB2D6", "#6A3D9A", "#FF7F00"
)
ggplot(fsumm.prop, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 4.2, show.legend = FALSE) +
facet_wrap(~ new.ID, labeller = labeller(new.ID = custom_labels), ncol = 1, scale = 'free_y') +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat2), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
scale_colour_manual(values = cols15) +
scale_fill_manual(values = cols15) +
guides(color = guide_legend(nrow = 5)) +
xlim(-0.02, 52)
ggsave2x('../plots-meas/NH3.flux.prop50', height = 10, width = 3.4)
treat2 <- c(`A` =  'Dig. A',
`B` =  'Dig. B',
`C` =  'Dig. C',
`D` =  'Dig. D',
`E` =  'Dig. E',
`F` =  'Dig. F',
`G` =  'Dig. G',
`H` =  'Dig. H',
`I` =  'Dig. I',
`Cattle A` =  'Cattle A',
`Cattle B` =  'Cattle B',
`Cattle C` =  'Cattle C',
`Pig A` =  'Pig A',
`Pig B` =  'Pig B',
`Pig C` =  'Pig C')
fsumm.prop <- fsumm[is.element(fsumm$new.ID, c('D1', 'D2', 'D3', 'D4', 'D5')), ]
treat2 <- c(`A` =  'Dig. A',
`B` =  'Dig. B',
`C` =  'Dig. C',
`D` =  'Dig. D',
`E` =  'Dig. E',
`F` =  'Dig. F',
`G` =  'Dig. G',
`H` =  'Dig. H',
`I` =  'Dig. I',
`Cattle A` =  'Cattle A',
`Cattle B` =  'Cattle B',
`Cattle C` =  'Cattle C',
`Pig A` =  'Pig A',
`Pig B` =  'Pig B',
`Pig C` =  'Pig C')
fsumm.prop[, treat2 := treat2[treat1]]
setorder(fsumm.prop, new.ID, treat2)
ll <- unique(fsumm.prop[, treat2])
labs <- data.table(treat2 = ll, i = as.integer(factor(ll, levels = ll)))
labs[, leg.lab := paste0(i, '. ', treat2)]
fsumm.prop[, tfact := factor(treat2, levels = ll)]
fsumm.prop[, leg.lab := factor(paste0(as.integer(tfact), '. ', tfact), levels = labs$leg.lab)]
# Manual adjustments to avoid overplotting
adj <- data.table(i      = c(1, 2, 3, 4, 5, 1, 6, 7, 8, 9, 1, 3, 8, 10, 11, 1, 6, 7, 12, 13, 1, 2, 4, 14, 15),
new.ID = c('D1', 'D1', 'D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D2', 'D2',
'D3', 'D3', 'D3', 'D3', 'D3', 'D4', 'D4', 'D4', 'D4', 'D4',
'D5', 'D5', 'D5', 'D5', 'D5'),
yshift = c(-0.003, -0.003, -0.003, 0.002, 0.003, -0.002, -0.005, 0.002, 0, 0,
0.001, 0.001, 0.00, 0, 0, -0.0002, 0, 0, 0, 0, -0.001, -0.001, 0.003, 0, 0))
adj[, new.ID := as.character(new.ID)]
# Get integer codes and initial emission
d0 <- fsumm.prop[, .(y = j.rel.mn[cta == min(cta)]), by = .(new.ID, leg.lab)]
labs <- merge(labs, d0)
labs <- merge(labs, adj, all = TRUE, by = c('i', 'new.ID'))
labs[is.na(yshift), yshift := 0]
labs[, y := y + yshift]
# define new labels for each subplot (Tral X instead of DX)
custom_labels <- c(
'D1' = 'Trial 1',
'D2' = 'Trial 2',
'D3' = 'Trial 3',
'D4' = 'Trial 4',
'D5' = 'Trial 5'
)
cols15 <- c(
"#1B9E77", "#D95F02", "#7570B3",  # your original 3
"#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666",
"#1F78B4", "#B2DF8A", "#FB9A99", "#FDBF6F",
"#CAB2D6", "#6A3D9A", "#FF7F00"
)
ggplot(fsumm.prop, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 4.2, show.legend = FALSE) +
facet_wrap(~ new.ID, labeller = labeller(new.ID = custom_labels), ncol = 1, scale = 'free_y') +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat2), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
scale_colour_manual(values = cols15) +
scale_fill_manual(values = cols15) +
guides(color = guide_legend(nrow = 5)) +
xlim(-0.02, 52)
ggsave2x('../plots-meas/NH3.flux.prop50', height = 10, width = 3.4)
ggsave2x('../plots-meas/NH3.flux.prop50', height = 10, width = 3.5)
ggplot(fsumm.prop, aes(cta, j.rel.mn, color = leg.lab, fill = leg.lab)) +
geom_point(shape = 1, size = 0.5) +
geom_line() +
geom_text(data = labs, x = 2, aes(y = y, label = i), hjust = 1, size = 4.2, show.legend = FALSE) +
facet_wrap(~ new.ID, labeller = labeller(new.ID = custom_labels), ncol = 1, scale = 'free_y') +
theme_bw() +
geom_ribbon(aes (ymax = j.rel.mn + j.rel.sd, ymin = j.rel.mn - j.rel.sd, group = treat2), alpha = 0.3, color = NA) +
ylab(expression(paste('Flux (frac. TAN  ', h^-1,')'))) + xlab('Time from application (h)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
scale_colour_manual(values = cols15) +
scale_fill_manual(values = cols15) +
guides(color = guide_legend(nrow = 3)) +
xlim(-0.02, 150)
ggsave2x('../plots-meas/NH3.flux.prop150', height = 9, width = 7)
