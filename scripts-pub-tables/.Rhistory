ggsave2x('../plots-meas/NH3.flux01.png', height = 10, width = 10)
# cumulative emission
ggplot(isumm, aes(treat, e.rel.150, color = treat)) +
geom_point() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(y = 'Loss (% of TAN) after 150 h') +
theme(legend.title = element_blank()) +
geom_boxplot(data = esumm, aes(x = treat, y = e.rel.150, color = treat), show.legend = FALSE)
ggsave2x('../plots-meas/cum.emis01.png', height = 10, width = 10)
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/scripts-pub-tables")
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
# converting digestate properties from character to numeric
sapply(dig.dat, class)
cols.nam <- c('amount', 'dublicate', 'TS', 'VS', 'mm2', 'mm2TS', 'density', 'K', 'n', 'r2', 'ammonium.N.A', 'totN', 'pH.lab', 'pH.field')
dig.dat[, (cols.nam) := lapply(.SD, as.numeric), .SDcols = cols.nam]
# Mean and sd of digestate properties
dsumm <- dig.dat[ , list(
amount.mn = mean(amount),
TS.mn = mean(TS), TS.sd = sd(TS), TS.n = length(TS),
VS.mn = mean(VS), VS.sd = sd(VS), VS.n = length(VS),
mm2.mn = mean(mm2), mm2.sd = sd(mm2), mm2.n = length(mm2),
mm2TS.mn = mean(mm2TS), mm2TS.sd = sd(mm2TS), mm2TS.n = length(mm2TS),
density.mn = mean(density), density.sd = sd(density), desnity.n = length(density),
K.mn = mean(K), K.sd = sd(K), K.n = length(K),
n.mn = mean(n), n.sd = mean(n), n.n = length(n),
r2.mn = mean(r2), r2.sd = sd(r2), r2.n = length(r2),
NH4.mn = mean(ammonium.N.A), NH4.sd = sd(ammonium.N.A), ammonium.N.A.n = length(ammonium.N.A),
totN.mn = mean(totN), totN.sd = sd(totN), totN.n = length(totN),
pH.lab.mn = mean(pH.lab), pH.lab.sd = sd(pH.lab), pH.lab.n = length(pH.lab),
pH.field.mn = mean(pH.field), pH.field.sd = sd(pH.field), pH.field.n = length(pH.field)
), by = list(experiment, code, cat, sep)]
# changing TAN and totN from mg/kg to g/kg
cols.nam <- c('totN.mn', 'totN.sd', 'NH4.mn', 'NH4.sd')
dsumm[, (cols.nam) := lapply(.SD, function(d) d/'1000'), .SDcols = cols.nam]
# changing TAN and totN from mg/kg to g/kg
cols.nam <- c('totN.mn', 'totN.sd', 'NH4.mn', 'NH4.sd')
sapply(dsumm, class)
cols.nam
# converting digestate properties from character to numeric
sapply(dig.dat, class)
cols <- c('amount', 'dublicate', 'TS', 'VS', 'mm2', 'mm2TS', 'density', 'K', 'n', 'r2', 'ammonium.N.A', 'totN', 'pH.lab', 'pH.field')
dig.dat[, (cols) := lapply(.SD, as.numeric), .SDcols = cols]
# Mean and sd of digestate properties
dsumm <- dig.dat[ , list(
amount.mn = mean(amount),
TS.mn = mean(TS), TS.sd = sd(TS), TS.n = length(TS),
VS.mn = mean(VS), VS.sd = sd(VS), VS.n = length(VS),
mm2.mn = mean(mm2), mm2.sd = sd(mm2), mm2.n = length(mm2),
mm2TS.mn = mean(mm2TS), mm2TS.sd = sd(mm2TS), mm2TS.n = length(mm2TS),
density.mn = mean(density), density.sd = sd(density), desnity.n = length(density),
K.mn = mean(K), K.sd = sd(K), K.n = length(K),
n.mn = mean(n), n.sd = mean(n), n.n = length(n),
r2.mn = mean(r2), r2.sd = sd(r2), r2.n = length(r2),
NH4.mn = mean(ammonium.N.A), NH4.sd = sd(ammonium.N.A), ammonium.N.A.n = length(ammonium.N.A),
totN.mn = mean(totN), totN.sd = sd(totN), totN.n = length(totN),
pH.lab.mn = mean(pH.lab), pH.lab.sd = sd(pH.lab), pH.lab.n = length(pH.lab),
pH.field.mn = mean(pH.field), pH.field.sd = sd(pH.field), pH.field.n = length(pH.field)
), by = list(experiment, code, cat, sep)]
dsumm[, (cols) := lapply(.SD, function(x) x/1000), .SDcols = cols]
dsumm[, (cols) := lapply(.SD, function(x) x*1000), .SDcols = cols]
cols
# changing TAN and totN from mg/kg to g/kg
cols <- c('totN.mn', 'totN.sd', 'NH4.mn', 'NH4.sd')
cols
dsumm[, (cols) := lapply(.SD, function(x) x * 1000), .SDcols = cols]
View(dsumm)
dsumm[, (cols) := lapply(.SD, function(x) x / 1000), .SDcols = cols]
# Mean and sd of digestate properties
dsumm <- dig.dat[ , list(
amount.mn = mean(amount),
TS.mn = mean(TS), TS.sd = sd(TS), TS.n = length(TS),
VS.mn = mean(VS), VS.sd = sd(VS), VS.n = length(VS),
mm2.mn = mean(mm2), mm2.sd = sd(mm2), mm2.n = length(mm2),
mm2TS.mn = mean(mm2TS), mm2TS.sd = sd(mm2TS), mm2TS.n = length(mm2TS),
density.mn = mean(density), density.sd = sd(density), desnity.n = length(density),
K.mn = mean(K), K.sd = sd(K), K.n = length(K),
n.mn = mean(n), n.sd = mean(n), n.n = length(n),
r2.mn = mean(r2), r2.sd = sd(r2), r2.n = length(r2),
NH4.mn = mean(ammonium.N.A), NH4.sd = sd(ammonium.N.A), ammonium.N.A.n = length(ammonium.N.A),
totN.mn = mean(totN), totN.sd = sd(totN), totN.n = length(totN),
pH.lab.mn = mean(pH.lab), pH.lab.sd = sd(pH.lab), pH.lab.n = length(pH.lab),
pH.field.mn = mean(pH.field), pH.field.sd = sd(pH.field), pH.field.n = length(pH.field)
), by = list(experiment, code, cat, sep)]
# changing TAN and totN from mg/kg to g/kg
cols <- c('totN.mn', 'totN.sd', 'NH4.mn', 'NH4.sd')
dsumm[, (cols) := lapply(.SD, function(x) x / 1000), .SDcols = cols]
# calculating app amount
dsumm$app.rate.mn <- dsumm$NH4.mn * dsumm$amount.mn
dsumm$app.rate.sd <- dsumm$NH4.sd * dsumm$amount.mn
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
# Summarizes data
# converting digestate properties from character to numeric
sapply(dig.dat, class)
cols <- c('amount', 'dublicate', 'TS', 'VS', 'mm2', 'mm2TS', 'density', 'K', 'n', 'r2', 'ammonium.N.A', 'totN', 'pH.lab', 'pH.field')
dig.dat[, (cols) := lapply(.SD, as.numeric), .SDcols = cols]
# Mean and sd of digestate properties
dsumm <- dig.dat[ , list(
amount.mn = mean(amount),
TS.mn = mean(TS), TS.sd = sd(TS), TS.n = length(TS),
VS.mn = mean(VS), VS.sd = sd(VS), VS.n = length(VS),
mm2.mn = mean(mm2), mm2.sd = sd(mm2), mm2.n = length(mm2),
mm2TS.mn = mean(mm2TS), mm2TS.sd = sd(mm2TS), mm2TS.n = length(mm2TS),
density.mn = mean(density), density.sd = sd(density), desnity.n = length(density),
K.mn = mean(K), K.sd = sd(K), K.n = length(K),
n.mn = mean(n), n.sd = mean(n), n.n = length(n),
r2.mn = mean(r2), r2.sd = sd(r2), r2.n = length(r2),
NH4.mn = mean(ammonium.N.A), NH4.sd = sd(ammonium.N.A), ammonium.N.A.n = length(ammonium.N.A),
totN.mn = mean(totN), totN.sd = sd(totN), totN.n = length(totN),
pH.lab.mn = mean(pH.lab), pH.lab.sd = sd(pH.lab), pH.lab.n = length(pH.lab),
pH.field.mn = mean(pH.field), pH.field.sd = sd(pH.field), pH.field.n = length(pH.field)
), by = list(experiment, code, cat, sep)]
# changing TAN and totN from mg/kg to g/kg
cols <- c('totN.mn', 'totN.sd', 'NH4.mn', 'NH4.sd')
dsumm[, (cols) := lapply(.SD, function(x) x / 1000), .SDcols = cols]
# calculating app amount
dsumm$app.rate.mn <- dsumm$NH4.mn * dsumm$amount.mn
dsumm$app.rate.sd <- dsumm$NH4.sd * dsumm$amount.mn
# Mean and sd of ESA data
Esumm <- ESA.dat[ , list(
area.perc.mn = mean(area.perc), area.perc.sd = sd(area.perc), n.area.perc = length(area.perc)
), by = list(experiment, treat)]
# converting soil properties from character to numeric
sapply(soil.dat, class)
cols.nam <- c('dublicate', 'bulk.dens', 'WC', 'W', 'crop.height', 'pH')
soil.dat[, (cols.nam) := lapply(.SD, as.numeric), .SDcols = cols.nam]
# Mean and sd of soil data
ssumm <- soil.dat[, list(
bulk.mn = mean(bulk.dens), bulk.sd = sd(bulk.dens), bulk.n = length(bulk.dens),
water.mn = mean(W), water.sd = sd(W), water.n = length(W)
), by = list(experiment, crop.height, pH)]
dsumm <- rounddf(as.data.frame(dsumm), digits = 2, func = signif)
View(dsumm)
header(dsumm)
head(dsumm)
# Mean and sd of digestate properties
dsumm <- dig.dat[ , list(
amount.mn = mean(amount),
TS.mn = mean(TS), TS.sd = sd(TS), TS.n = length(TS),
VS.mn = mean(VS), VS.sd = sd(VS), VS.n = length(VS),
mm2.mn = mean(mm2), mm2.sd = sd(mm2), mm2.n = length(mm2),
mm2TS.mn = mean(mm2TS), mm2TS.sd = sd(mm2TS), mm2TS.n = length(mm2TS),
density.mn = mean(density), desnity.n = length(density),
K.mn = mean(K), K.n = length(K),
n.mn = mean(n), n.n = length(n),
r2.mn = mean(r2),
NH4.mn = mean(ammonium.N.A), NH4.sd = sd(ammonium.N.A), ammonium.N.A.n = length(ammonium.N.A),
totN.mn = mean(totN), totN.sd = sd(totN), totN.n = length(totN),
pH.lab.mn = mean(pH.lab), pH.lab.sd = sd(pH.lab), pH.lab.n = length(pH.lab),
pH.field.mn = mean(pH.field), pH.field.sd = sd(pH.field), pH.field.n = length(pH.field)
), by = list(experiment, code, cat, sep)]
sig2 <- c('amount', 'app.rate.mn', 'NH4.mn', 'NH4.sd', 'totN.mn', 'totN.sd')
sig3 <- c('TS.mn', 'TS.sd', 'mm2.mn', 'mm2.sd', 'mm2TS.mn', 'mm2TS.sd', 'density.mn', 'r2.mn')
sig4 <- c('VS.mn', 'VS.sd', 'K.mn', 'n.mn')
dsumm[sig2, ] <- rounddf(as.data.frame(dsumm[sig2, ]), digits = 2, func = signif)
dsumm[sig2, ]
dsumm[, sig2] <- rounddf(as.data.frame(dsumm[sig2, ]), digits = 2, func = signif)
dsumm[, sig2] <- rounddf(as.data.frame(dsumm[, sig2]), digits = 2, func = signif)
as.data.frame(dsumm[, sig2]) <- rounddf(as.data.frame(dsumm[, sig2]), digits = 2, func = signif)
dsumm[, sig2]
as.data.frame(dsumm[, sig2])
dsumm <- as.data.frame(dsumm)
dsumm[, sig2] <- rounddf(dsumm[, sig2], digits = 2, func = signif)
dsumm[, sig2]
sig2
dsumm[, c(sig2)] <- rounddf(dsumm[, sig2], digits = 2, func = signif)
dsumm[, c(sig2)]
sig2 <- c('amount.mn', 'app.rate.mn', 'NH4.mn', 'NH4.sd', 'totN.mn', 'totN.sd')
dsumm <- as.data.frame(dsumm)
dsumm[, c(sig2)]
# Summarizes data
# converting digestate properties from character to numeric
sapply(dig.dat, class)
cols <- c('amount', 'dublicate', 'TS', 'VS', 'mm2', 'mm2TS', 'density', 'K', 'n', 'r2', 'ammonium.N.A', 'totN', 'pH.lab', 'pH.field')
dig.dat[, (cols) := lapply(.SD, as.numeric), .SDcols = cols]
# Mean and sd of digestate properties
dsumm <- dig.dat[ , list(
amount.mn = mean(amount),
TS.mn = mean(TS), TS.sd = sd(TS), TS.n = length(TS),
VS.mn = mean(VS), VS.sd = sd(VS), VS.n = length(VS),
mm2.mn = mean(mm2), mm2.sd = sd(mm2), mm2.n = length(mm2),
mm2TS.mn = mean(mm2TS), mm2TS.sd = sd(mm2TS), mm2TS.n = length(mm2TS),
density.mn = mean(density), desnity.n = length(density),
K.mn = mean(K), K.n = length(K),
n.mn = mean(n), n.n = length(n),
r2.mn = mean(r2),
NH4.mn = mean(ammonium.N.A), NH4.sd = sd(ammonium.N.A), ammonium.N.A.n = length(ammonium.N.A),
totN.mn = mean(totN), totN.sd = sd(totN), totN.n = length(totN),
pH.lab.mn = mean(pH.lab), pH.lab.sd = sd(pH.lab), pH.lab.n = length(pH.lab),
pH.field.mn = mean(pH.field), pH.field.sd = sd(pH.field), pH.field.n = length(pH.field)
), by = list(experiment, code, cat, sep)]
# changing TAN and totN from mg/kg to g/kg
cols <- c('totN.mn', 'totN.sd', 'NH4.mn', 'NH4.sd')
dsumm[, (cols) := lapply(.SD, function(x) x / 1000), .SDcols = cols]
# calculating app amount
dsumm$app.rate.mn <- dsumm$NH4.mn * dsumm$amount.mn
dsumm$app.rate.sd <- dsumm$NH4.sd * dsumm$amount.mn
sig2 <- c('amount.mn', 'app.rate.mn', 'NH4.mn', 'NH4.sd', 'totN.mn', 'totN.sd')
dsumm[, c(sig2)]
dsumm[, sig2]
dsumm[, c(sig2)] <- rounddf(dsumm[, sig2], digits = 2, func = signif)
dsumm[, c(sig2)]
dsumm <- as.data.frame(dsumm)
dsumm[, c(sig2)] <- rounddf(dsumm[, sig2], digits = 2, func = signif)
sig3 <- c('TS.mn', 'TS.sd', 'mm2.mn', 'mm2.sd', 'mm2TS.mn', 'mm2TS.sd', 'density.mn', 'r2.mn')
sig4 <- c('VS.mn', 'VS.sd', 'K.mn', 'n.mn')
dsumm[, sig2] <- rounddf(dsumm[, sig2], digits = 2, func = signif)
dsumm[, sig3] <- rounddf(dsumm[, sig3], digits = 3, func = signif)
dsumm[, sig4] <- rounddf(dsumm[, sig4], digits = 4, func = signif)
# Summarizes data
# converting digestate properties from character to numeric
sapply(dig.dat, class)
cols <- c('amount', 'dublicate', 'TS', 'VS', 'mm2', 'mm2TS', 'density', 'K', 'n', 'r2', 'ammonium.N.A', 'totN', 'pH.lab', 'pH.field')
dig.dat[, (cols) := lapply(.SD, as.numeric), .SDcols = cols]
# Mean and sd of digestate properties
dsumm <- dig.dat[ , list(
amount.mn = mean(amount),
TS.mn = mean(TS), TS.sd = sd(TS), TS.n = length(TS),
VS.mn = mean(VS), VS.sd = sd(VS), VS.n = length(VS),
mm2.mn = mean(mm2), mm2.sd = sd(mm2), mm2.n = length(mm2),
mm2TS.mn = mean(mm2TS), mm2TS.sd = sd(mm2TS), mm2TS.n = length(mm2TS),
density.mn = mean(density), desnity.n = length(density),
K.mn = mean(K), K.n = length(K),
n.mn = mean(n), n.n = length(n),
r2.mn = mean(r2),
NH4.mn = mean(ammonium.N.A), NH4.sd = sd(ammonium.N.A), ammonium.N.A.n = length(ammonium.N.A),
totN.mn = mean(totN), totN.sd = sd(totN), totN.n = length(totN),
pH.lab.mn = mean(pH.lab), pH.lab.sd = sd(pH.lab), pH.lab.n = length(pH.lab),
pH.field.mn = mean(pH.field), pH.field.sd = sd(pH.field), pH.field.n = length(pH.field)
), by = list(experiment, code, cat, sep)]
# changing TAN and totN from mg/kg to g/kg
cols <- c('totN.mn', 'totN.sd', 'NH4.mn', 'NH4.sd')
dsumm[, (cols) := lapply(.SD, function(x) x / 1000), .SDcols = cols]
# calculating app amount
dsumm$app.rate.mn <- dsumm$NH4.mn * dsumm$amount.mn
dsumm$app.rate.sd <- dsumm$NH4.sd * dsumm$amount.mn
sig2 <- c('amount.mn', 'app.rate.mn', 'NH4.mn', 'NH4.sd', 'totN.mn', 'totN.sd', 'pH.lab.mn', 'pH.lab.sd', 'pH.field.mn', 'pH.field.sd')
sig3 <- c('TS.mn', 'TS.sd', 'mm2.mn', 'mm2.sd', 'mm2TS.mn', 'mm2TS.sd', 'density.mn', 'r2.mn')
sig4 <- c('VS.mn', 'VS.sd', 'K.mn', 'n.mn')
dsumm <- as.data.frame(dsumm)
dsumm[, sig2] <- rounddf(dsumm[, sig2], digits = 2, func = signif)
dsumm[, sig3] <- rounddf(dsumm[, sig3], digits = 3, func = signif)
dsumm[, sig4] <- rounddf(dsumm[, sig4], digits = 4, func = signif)
dsumm
colnames(dsumm)
dsumm$TS <- paste(dsumm$TS.mn, ' ± ', dsumm$TS.sd)
dsumm$VS <- paste(dsumm$VS.mn, ' ± ', dsumm$VS.sd)
dsumm$mm2 <- paste(dsumm$mm2.mn, ' ± ', dsumm$mm2.sd)
dsumm$mm2TS <- paste(dsumm$mm2TS.mn, ' ± ', dsumm$mm2TS.sd)
# Summarizes data
# converting digestate properties from character to numeric
sapply(dig.dat, class)
cols <- c('amount', 'dublicate', 'TS', 'VS', 'mm2', 'mm2TS', 'density', 'K', 'n', 'r2', 'ammonium.N.A', 'totN', 'pH.lab', 'pH.field')
dig.dat[, (cols) := lapply(.SD, as.numeric), .SDcols = cols]
# Mean and sd of digestate properties
dsumm <- dig.dat[ , list(
amount.mn = mean(amount),
TS.mn = mean(TS), TS.sd = sd(TS), TS.n = length(TS),
VS.mn = mean(VS), VS.sd = sd(VS), VS.n = length(VS),
mm2.mn = mean(mm2), mm2.sd = sd(mm2), mm2.n = length(mm2),
mm2TS.mn = mean(mm2TS), mm2TS.sd = sd(mm2TS), mm2TS.n = length(mm2TS),
density.mn = mean(density), desnity.n = length(density),
K.mn = mean(K), K.n = length(K),
n.mn = mean(n), n.n = length(n),
r2.mn = mean(r2),
NH4.mn = mean(ammonium.N.A), NH4.sd = sd(ammonium.N.A), ammonium.N.A.n = length(ammonium.N.A),
totN.mn = mean(totN), totN.sd = sd(totN), totN.n = length(totN),
pH.lab.mn = mean(pH.lab), pH.lab.sd = sd(pH.lab), pH.lab.n = length(pH.lab),
pH.field.mn = mean(pH.field), pH.field.sd = sd(pH.field), pH.field.n = length(pH.field)
), by = list(experiment, code, cat, sep)]
# changing TAN and totN from mg/kg to g/kg
cols <- c('totN.mn', 'totN.sd', 'NH4.mn', 'NH4.sd')
dsumm[, (cols) := lapply(.SD, function(x) x / 1000), .SDcols = cols]
# calculating app amount
dsumm$app.rate.mn <- dsumm$NH4.mn * dsumm$amount.mn
dsumm$app.rate.sd <- dsumm$NH4.sd * dsumm$amount.mn
sig2 <- c('amount.mn', 'app.rate.mn', 'NH4.mn', 'NH4.sd', 'totN.mn', 'totN.sd', 'pH.lab.mn', 'pH.lab.sd', 'pH.field.mn', 'pH.field.sd')
sig3 <- c('TS.mn', 'TS.sd', 'mm2.mn', 'mm2.sd', 'mm2TS.mn', 'mm2TS.sd', 'density.mn', 'r2.mn')
sig4 <- c('VS.mn', 'VS.sd', 'K.mn', 'n.mn')
dsumm <- as.data.frame(dsumm)
dsumm[, sig2] <- rounddf(dsumm[, sig2], digits = 2, func = signif)
dsumm[, sig3] <- rounddf(dsumm[, sig3], digits = 3, func = signif)
dsumm[, sig4] <- rounddf(dsumm[, sig4], digits = 4, func = signif)
colnames(dsumm)
dsumm$TS <- paste(dsumm$TS.mn, ' ± ', dsumm$TS.sd)
dsumm$VS <- paste(dsumm$VS.mn, ' ± ', dsumm$VS.sd)
dsumm$mm2 <- paste(dsumm$mm2.mn, ' ± ', dsumm$mm2.sd)
dsumm$mm2TS <- paste(dsumm$mm2TS.mn, ' ± ', dsumm$mm2TS.sd)
dsumm$NH4 <- paste(dsumm$NH4.mn, ' ± ', dsumm$NH4.sd)
dsumm$totN <- paste(dsumm$totN.mn, ' ± ', dsumm$totN.sd)
dsumm$pH.lab <- paste(dsumm$pH.lab.mn, ' ± ', dsumm$pH.lab.sd)
dsumm$pH.field <- paste(dsumm$pH.field.mn, ' ± ', dsumm$pH.field.sd)
# Select some cols from esumm to export
dsumm.ex <- dsumm[, c('experiment', 'code', 'cat', 'sep', 'amount.mn', 'app.rate.mn', 'TS', 'VS', 'mm2', 'mm2TS', 'density.mn', 'K.mn', 'n.mn', 'r2.mn',
'NH4', 'totN', 'pH.lab', 'pH.field')]
View(dsumm.ex)
Esumm <- ESA.dat[ , list(
area.perc.mn = mean(area.perc), area.perc.sd = sd(area.perc), n.area.perc = length(area.perc)
), by = list(experiment, treat)]
Esumm <- rounddf(as.data.frame(Esumm), 2, func = signif)
View(Esumm)
View(Esumm)
colname(Esumm$treat) <- 'code'
col.name(Esumm$treat) <- 'code'
colnames(Esumm$treat) <- 'code'
colnames(Esumm$treat)
colnames(Esumm) <- 'code'
colnames(Esumm)
Esumm <- ESA.dat[ , list(
area.perc.mn = mean(area.perc), area.perc.sd = sd(area.perc), n.area.perc = length(area.perc)
), by = list(experiment, treat)]
Esumm <- rounddf(as.data.frame(Esumm), 2, func = signif)
colnames(Esumm)['treat'] <- 'code'
colnames(Esumm)['treat']
colnames(Esumm)[which(names(Esumm) == 'treat')] <- 'code'
test <- merge(dsumm, Esumm, b = c('experiment', 'code'))
test <- merge(dsumm, Esumm, by = c('experiment', 'code'))
test <- merge(Esumm, dsumm, by = c('experiment', 'code'))
test <- merge(dsumm, Esumm, by = c('experiment', 'code'), all.x = TRUE)
View(test)
dsumm <- merge(dsumm, Esumm, by = c('experiment', 'code'), all.x = TRUE)
dsumm$TS <- paste(dsumm$TS.mn, ' ± ', dsumm$TS.sd)
dsumm$VS <- paste(dsumm$VS.mn, ' ± ', dsumm$VS.sd)
dsumm$ESA <- pase(dsumm$area.perc.mn, ' ± ', dsumm$area.perc.sd)
dsumm$ESA <- paste(dsumm$area.perc.mn, ' ± ', dsumm$area.perc.sd)
# Combinding ESA data with digestate properties data
colnames(Esumm)[which(names(Esumm) == 'treat')] <- 'code'
dsumm <- merge(dsumm, Esumm, by = c('experiment', 'code'), all.x = TRUE)
# Digestate properties
dsumm$TS <- paste(dsumm$TS.mn, ' ± ', dsumm$TS.sd)
dsumm$VS <- paste(dsumm$VS.mn, ' ± ', dsumm$VS.sd)
dsumm$ESA <- paste(dsumm$area.perc.mn, ' ± ', dsumm$area.perc.sd)
dsumm$mm2 <- paste(dsumm$mm2.mn, ' ± ', dsumm$mm2.sd)
dsumm$mm2TS <- paste(dsumm$mm2TS.mn, ' ± ', dsumm$mm2TS.sd)
dsumm$NH4 <- paste(dsumm$NH4.mn, ' ± ', dsumm$NH4.sd)
dsumm$totN <- paste(dsumm$totN.mn, ' ± ', dsumm$totN.sd)
dsumm$pH.lab <- paste(dsumm$pH.lab.mn, ' ± ', dsumm$pH.lab.sd)
dsumm$pH.field <- paste(dsumm$pH.field.mn, ' ± ', dsumm$pH.field.sd)
# Select some cols from esumm to export
dsumm.ex <- dsumm[, c('experiment', 'code', 'cat', 'sep', 'amount.mn', 'app.rate.mn', 'TS', 'VS', 'ESA' 'mm2', 'mm2TS', 'density.mn', 'K.mn', 'n.mn', 'r2.mn',
# Select some cols from esumm to export
dsumm.ex <- dsumm[, c('experiment', 'code', 'cat', 'sep', 'amount.mn', 'app.rate.mn', 'TS', 'VS', 'ESA', 'mm2', 'mm2TS', 'density.mn', 'K.mn', 'n.mn', 'r2.mn',
'NH4', 'totN', 'pH.lab', 'pH.field')]
View(dsumm.ex)
write.csv(dsumm.ex, '../output/digestate.table.csv', row.names = FALSE)
View(dsumm.ex)
View(dsumm)
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/scripts-pub-tables")
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('summary_dig.R')
source('summary_ESA.R')
colnames(Esumm)[which(names(Esumm) == 'treat')] <- 'code'
dsumm <- merge(dsumm, Esumm, by = c('experiment', 'code'), all.x = TRUE)
# Digestate properties
dsumm$TS <- paste(dsumm$TS.mn, ' ± ', dsumm$TS.sd)
dsumm$VS <- paste(dsumm$VS.mn, ' ± ', dsumm$VS.sd)
dsumm$ESA <- paste(dsumm$area.perc.mn, ' ± ', dsumm$area.perc.sd)
dsumm$mm2 <- paste(dsumm$mm2.mn, ' ± ', dsumm$mm2.sd)
dsumm$mm2TS <- paste(dsumm$mm2TS.mn, ' ± ', dsumm$mm2TS.sd)
dsumm$NH4 <- paste(dsumm$NH4.mn, ' ± ', dsumm$NH4.sd)
dsumm$totN <- paste(dsumm$totN.mn, ' ± ', dsumm$totN.sd)
dsumm$pH.lab <- paste(dsumm$pH.lab.mn, ' ± ', dsumm$pH.lab.sd)
dsumm$pH.field <- paste(dsumm$pH.field.mn, ' ± ', dsumm$pH.field.sd)
# Select some cols from esumm to export
dsumm.ex <- dsumm[, c('experiment', 'code', 'cat', 'sep', 'amount.mn', 'app.rate.mn', 'TS', 'VS', 'ESA', 'mm2', 'mm2TS', 'density.mn', 'K.mn', 'n.mn', 'r2.mn',
'NH4', 'totN', 'pH.lab', 'pH.field')]
View(dsumm.ex)
write.csv(dsumm.ex, '../output/digestate.table.csv', row.names = FALSE)
write.csv(dsumm.ex, '../output/digestate.table.csv', row.names = FALSE)
# converting soil properties from character to numeric
sapply(soil.dat, class)
cols.nam <- c('dublicate', 'bulk.dens', 'WC', 'W', 'crop.height', 'pH')
soil.dat[, (cols.nam) := lapply(.SD, as.numeric), .SDcols = cols.nam]
# Mean and sd of soil data
ssumm <- soil.dat[, list(
bulk.mn = mean(bulk.dens), bulk.sd = sd(bulk.dens), bulk.n = length(bulk.dens),
water.mn = mean(W), water.sd = sd(W), water.n = length(W)
), by = list(experiment, crop.height, pH)]
View(ssumm)
sig2 <- c('water.mn', 'water.sd')
sig3 <- c('bulk.mn', 'bulk.sd')
dsumm <- as.data.frame(dsumm)
ssumm <- as.data.frame(ssumm)
ssumm[, sig2] <- rounddf(ssumm[, sig2], digits = 2, func = signif)
ssumm[, sig3] <- rounddf(ssumm[, sig3], digits = 3, func = signif)
View(temp.dat)
# Temperature
temp.dat$mean <- paste(temp.dat$air.temp.mean, '(', temp.dat$air.temp.min, ';', temp.dat$air.temp.max)
# Temperature
temp.dat$temp.mean <- paste(temp.dat$air.temp.mean, '(', temp.dat$air.temp.min, ';', temp.dat$air.temp.max)
# Temperature
temp.dat$temp.mean <- paste(temp.dat$air.temp.mean, '(', temp.dat$air.temp.min, ';', temp.dat$air.temp.max, ')')
# Temperature
temp.dat$temp.mean <- paste(temp.dat$air.temp.mean, '(', temp.dat$air.temp.min, ';', temp.dat$air.temp.max,')')
View(ssumm)
# Soil data
ssumm$bulk <- paste(ssumm$bulk.mn, ' ± ', ssumm$bulk.sd)
ssumm$water <- paste(ssumm$water.mn, ' ± ', ssumm$water.sd)
View(ESA.dat)
View(temp.dat)
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/data-emission/scripts")
rm(list = ls())
source('packages.R')
source('load.R')
# subsetting data from the MAG project
pdat <- subset(pdat, proj == 'MAG')
# excluding data from fall 2022 where chambers where tested
pdat <- subset(pdat, t.start.p > '2023-01-01 00:00:00')
# Drop non-relevant obs from emis interval data
idat <- subset(idat, pmid %in% unique(pdat$pmid))
write.csv(idat, '../data/MAG_interval.csv', row.names = FALSE)
write.csv(pdat, '../data/MAG_plot.csv', row.names = FALSE)
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/scripts-meas")
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
pdat$tk <- pdat$exper
# Merge in plot level variables
idat <- merge(pdat, idat, by = c('pid', 'pmid'))
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('subset.R')
source('summary.R')
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('subset.R')
source('summary.R')
source('export.R')
source('plot.R')
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/scripts-pub-tables")
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('summary_dig.R')
source('summary_ESA.R')
source('summary_soil.R')
# Combinding ESA data with digestate properties data
colnames(Esumm)[which(names(Esumm) == 'treat')] <- 'code'
dsumm <- merge(dsumm, Esumm, by = c('experiment', 'code'), all.x = TRUE)
# Digestate properties
dsumm$TS <- paste(dsumm$TS.mn, ' ± ', dsumm$TS.sd)
dsumm$VS <- paste(dsumm$VS.mn, ' ± ', dsumm$VS.sd)
dsumm$ESA <- paste(dsumm$area.perc.mn, ' ± ', dsumm$area.perc.sd)
dsumm$mm2 <- paste(dsumm$mm2.mn, ' ± ', dsumm$mm2.sd)
dsumm$mm2TS <- paste(dsumm$mm2TS.mn, ' ± ', dsumm$mm2TS.sd)
dsumm$NH4 <- paste(dsumm$NH4.mn, ' ± ', dsumm$NH4.sd)
dsumm$totN <- paste(dsumm$totN.mn, ' ± ', dsumm$totN.sd)
dsumm$pH.lab <- paste(dsumm$pH.lab.mn, ' ± ', dsumm$pH.lab.sd)
dsumm$pH.field <- paste(dsumm$pH.field.mn, ' ± ', dsumm$pH.field.sd)
# Select some cols from esumm to export
dsumm.ex <- dsumm[, c('experiment', 'code', 'cat', 'sep', 'amount.mn', 'app.rate.mn', 'TS', 'VS', 'ESA', 'mm2', 'mm2TS', 'density.mn', 'K.mn', 'n.mn', 'r2.mn',
'NH4', 'totN', 'pH.lab', 'pH.field')]
write.csv(dsumm.ex, '../output/digestate.table.csv', row.names = FALSE)
# Temperature
temp.dat$temp.mean <- paste(temp.dat$air.temp.mean, '(', temp.dat$air.temp.min, ';', temp.dat$air.temp.max,')')
# Soil data
ssumm$bulk <- paste(ssumm$bulk.mn, ' ± ', ssumm$bulk.sd)
ssumm$water <- paste(ssumm$water.mn, ' ± ', ssumm$water.sd)
View(temp.dat)
View(ssumm)
colnames(temp.dat)[which(names(temp.dat) == 'trial')] <- 'experiment'
# Soil data
ssumm$bulk <- paste(ssumm$bulk.mn, ' ± ', ssumm$bulk.sd)
ssumm$water <- paste(ssumm$water.mn, ' ± ', ssumm$water.sd)
stsumm <- merge(temp.dat, ssumm, by = c('experiment'))
View(stsumm)
stsumm.ex <- stsumm[, c('experiment', 'dt', 'bulk', 'water', 'pH', 'crop.height', 'air.temp.start', 'temp.mean')]
View(stsumm.ex)
temp.dat$app.meth <- temp.dat$experiment
# Add application method (manual/machine) and treamtment to data frame
tk <- c(`23C` = 'Manual', `23D` = 'Manual', `23G` = 'Manual', `23H` = 'Manual', `23I` = 'Manual')
temp.dat$app.meth <- tk[temp.dat$experiment]
tk <- c(`23C` = 'Treatment of digestate', `23D` = 'Treatment of digestate', `23G` = 'Treatment of digestate',
`23H` = 'Digestate properties', `23I` = 'Digestate properties')
temp.dat$treat.var <- tk[temp.dat$experiment]
# Soil data
ssumm$bulk <- paste(ssumm$bulk.mn, ' ± ', ssumm$bulk.sd)
ssumm$water <- paste(ssumm$water.mn, ' ± ', ssumm$water.sd)
stsumm <- merge(temp.dat, ssumm, by = c('experiment'))
stsumm.ex <- stsumm[, c('experiment', 'dt', 'app.meth', 'treat.var', 'bulk', 'water', 'pH', 'crop.height', 'air.temp.start', 'temp.mean')]
write.csv(stsumm.ex, '../output/trial.table.csv', row.names = FALSE)
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('summary_dig.R')
source('summary_ESA.R')
source('summary_soil.R')
source('export.R')
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('summary_dig.R')
source('summary_ESA.R')
source('summary_soil.R')
source('export.R')
