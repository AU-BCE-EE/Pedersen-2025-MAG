theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
# temperature
ggplot(idat[idat$treat == 'A' | idat$treat == '2-pos' & idat$rep == '1', ], aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
# temperature
ggplot(idat[idat$treat == 'A' | idat$treat == '2-pos' | idat$treat == 'TS-TSB-4' & idat$rep == '1', ], aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
# temperature
ggplot(idat[idat$treat == 'A' | idat$treat == '2-pos' | idat$treat == 'TS-TSB-4' | idat$treat == 'TH' | idat$treat == 'Un12' & idat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
# temperature
ggplot(idat[idat$treat == 'A' | idat$treat == '2-pos' | idat$treat == 'TS-TSB-4' | idat$treat == 'TH' | idat$treat == 'Un12', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
# temperature
ggplot(idat[idat$treat == 'A' & idat$rep == '1' | idat$treat == '2-pos' & idat$rep == '1' | idat$treat == 'TS-TSB-4' & idat$rep == '1' | idat$treat == 'TH' & idat$rep == '1' | idat$treat == 'Un12' & idat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
# temperature
ggplot(idat[idat$treat == 'A' & idat$rep == '1' | idat$treat == '2-pos' & idat$rep == '1' | idat$treat == 'TS-TSB-4' & idat$rep == '1' | idat$treat == 'TH' & idat$rep == '1' | idat$treat == 'Un12' & idat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_point() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
# temperature
ggplot(idat[idat$treat == 'A' & idat$rep == '1' | idat$treat == '2-pos' & idat$rep == '1' | idat$treat == 'TS-TSB-4' & idat$rep == '1' | idat$treat == 'TH' & idat$rep == '1' | idat$treat == 'Un12' & idat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
idat.treat <- idat[is.element(stsumm$exper, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')), ]
idat.treat <- idat[is.element(stsumm$exper, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')), ]
idat.treat <- idat[is.element(idat$exper, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')), ]
idat.prop <- idat[is.element(idat$exper, c('23H', '23I', '24E', '24F', '24G')), ]
ggplot(idat.treat, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ trial) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/NH3.flux01.treat.png', height = 10, width = 10)
ggsave2x('../plots-meas/NH3.flux01.prop.png', height = 10, width = 10)
ggplot(idat.prop, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ trial) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/NH3.flux01.prop.png', height = 10, width = 10)
ggplot(idat.treat[idat$treat == 'A' & idat$rep == '1' | idat$treat == '2-pos' & idat$rep == '1' | idat$treat == 'TS-TSB-4' & idat$rep == '1' | idat$treat == 'TH' & idat$rep == '1' | idat$treat == 'Un12' & idat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggplot(idat.treat[idat.treat$treat == 'A' & idat.treat$rep == '1' | idat.treat$treat == '2-pos' & idat.treat$rep == '1' | idat.treat$treat == 'TS-TSB-4' & idat.treat$rep == '1' | idat.treat$treat == 'TH' & idat.treat$rep == '1' | idat.treat$treat == 'Un12' & idat.treat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/temp.treat.png', height = 10, width = 10)
ggplot(idat[idat.prop$treat == 'A' & idat.prop$rep == '1' | idat.prop$treat == '2-pos' & idat.prop$rep == '1' | idat.prop$treat == 'TS-TSB-4' & idat.prop$rep == '1' | idat.prop$treat == 'TH' & idat.prop$rep == '1' | idat.prop$treat == 'Un12' & idat.prop$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggplot(idat.prop[idat.prop$treat == 'A' & idat.prop$rep == '1' | idat.prop$treat == '2-pos' & idat.prop$rep == '1' | idat.prop$treat == 'TS-TSB-4' & idat.prop$rep == '1' | idat.prop$treat == 'TH' & idat.prop$rep == '1' | idat.prop$treat == 'Un12' & idat.prop$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('Air temperature', '')) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/temp.prop.png', height = 10, width = 10)
labs(x = 'Time after application (h)', y = 'Air temperature (째C)) +
ggplot(idat.prop[idat.prop$treat == 'A' & idat.prop$rep == '1' | idat.prop$treat == '2-pos' & idat.prop$rep == '1' | idat.prop$treat == 'TS-TSB-4' & idat.prop$rep == '1' | idat.prop$treat == 'TH' & idat.prop$rep == '1' | idat.prop$treat == 'Un12' & idat.prop$rep == '1', ],
ggplot(idat.prop[idat.prop$treat == 'A' & idat.prop$rep == '1' | idat.prop$treat == '2-pos' & idat.prop$rep == '1' | idat.prop$treat == 'TS-TSB-4' & idat.prop$rep == '1' | idat.prop$treat == 'TH' & idat.prop$rep == '1' | idat.prop$treat == 'Un12' & idat.prop$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = 'Air temperature (째C)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/temp.prop.png', height = 10, width = 10)
ggplot(idat.treat[idat.treat$treat == 'A' & idat.treat$rep == '1' | idat.treat$treat == '2-pos' & idat.treat$rep == '1' | idat.treat$treat == 'TS-TSB-4' & idat.treat$rep == '1' | idat.treat$treat == 'TH' & idat.treat$rep == '1' | idat.treat$treat == 'Un12' & idat.treat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = 'Air temperature (째C)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/temp.treat.png', height = 10, width = 10)
# temperature
ggplot(idat[idat$treat == 'A' & idat$rep == '1' | idat$treat == '2-pos' & idat$rep == '1' | idat$treat == 'TS-TSB-4' & idat$rep == '1' | idat$treat == 'TH' & idat$rep == '1' | idat$treat == 'Un12' & idat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ trial, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = 'Air temperature (째C)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/temp.png', height = 10, width = 10)
ggplot(idat.treat, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ trial) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
idat.treat$new.ID <- idat.treat$trial
sub('23C', '1', idat.treat$newID)
gsub('23C', '1', idat.treat$newID)
gsub('23C', '1', idat.treat$newID)
gsub('23C', '1', idat.treat$new.ID)
idat.treat$new.ID <- gsub('23C', '1', idat.treat$new.ID)
View(idat)
View(idat.treat)
idat.treat <- idat[is.element(idat$exper, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')), ]
idat.treat$new.ID <- idat.treat$trial
idat.treat$new.ID <- gsub('23C', '1', idat.treat$new.ID)
idat.treat$new.ID <- gsub('23D', '2', idat.treat$new.ID)
idat.treat$new.ID <- gsub('23G', '3', idat.treat$new.ID)
idat.treat$new.ID <- gsub('23M', '4', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24B', '5', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24H', '6', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24C', '7', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24D', '8', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24J', '9', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24L', '10', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24N', '11', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24O', '12', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24A', '13', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24I', '14', idat.treat$new.ID)
idat.treat$new.ID <- gsub('24K', '15', idat.treat$new.ID)
ggplot(idat.treat, aes(cta, j.NH3, group = new.ID, color = treat)) +
geom_point() +
facet_wrap(~ trial) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggplot(idat.treat, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ new.ID) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
idat.treat$new.ID <- gsub('24M', '4', idat.treat$new.ID)
# flux over time
ggplot(idat, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ trial) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/NH3.flux01.png', height = 10, width = 10)
ggplot(idat.treat, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ new.ID) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/NH3.flux01.treat.png', height = 10, width = 10)
ggplot(idat.treat[idat.treat$treat == 'A' & idat.treat$rep == '1' | idat.treat$treat == '2-pos' & idat.treat$rep == '1' | idat.treat$treat == 'TS-TSB-4' & idat.treat$rep == '1' | idat.treat$treat == 'TH' & idat.treat$rep == '1' | idat.treat$treat == 'Un12' & idat.treat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ new.ID, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = 'Air temperature (째C)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/temp.treat.png', height = 10, width = 10)
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('subset.R')
# Summarizes measurements
# cumulative emissions:
isumm1 <- idat[, .(e.cum.final = max(e.cum),
e.rel.final = max(e.rel),
e.cum.150 = approx(cta, e.cum, xout = 150)$y,
e.rel.150 = approx(cta, e.rel, xout = 150)$y
), by = list(trial, treat, pmid)]
# cumulative emissions for experiments 24C, 24N, 24O as they are not close to 150 h emission:
isumm2 <- idat[is.element(idat$exper, c('24C', '24N', '24O')), .(e.cum.final = max(e.cum),
e.rel.final = max(e.rel),
e.cum.150 = approx(cta, e.cum, xout = 85)$y,
e.rel.150 = approx(cta, e.rel, xout = 85)$y
), by = list(trial, treat, pmid)]
# combining the isumm
isumm <- rbind(isumm1, isumm2)
# remove one observation where there is no measurements after 2.48 h.
isumm <- isumm[! is.na(e.rel.150)]
# temperature data
wsumm <- idat[, .(dt = t.start.p[1],
air.temp.start = mean(air.temp[interval == 1]),
air.temp.mean = mean(air.temp),
air.temp.min = min(air.temp),
air.temp.max = max(air.temp))
, by = list(trial)]
# Mean and sd of cumulative emission
esumm <- isumm[ , list(
pmid = paste(pmid, collapse = ', '),
e.rel.final = mean(e.rel.final), e.rel.final.sd = sd(e.rel.final), e.rel.final.n = length(e.rel.final),
e.cum.final = mean(e.cum.final), e.cum.final.sd = sd(e.cum.final), e.cum.final.n = length(e.cum.final),
e.rel.150 = mean(e.rel.150), e.rel.150.sd = sd(e.rel.150), e.rel.150.n = length(e.rel.150),
e.cum.150 = mean(e.cum.150), e.cum.150.sd = sd(e.cum.150), e.cum.150.n = length(e.cum.150)
), by = list(trial, treat)]
isumm <- rounddf(as.data.frame(isumm), digits = 3, func = signif)
esumm <- rounddf(as.data.frame(esumm), 3, func = signif)
wsumm <- rounddf(as.data.frame(wsumm), 3, func = signif)
# Select some cols from esumm to export
esumm.ex <- esumm[, c('trial', 'treat', 'e.rel.150', 'e.rel.150.sd', 'e.rel.150.n')]
idat.treat <- idat[is.element(idat$exper, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')), ]
idat.prop <- idat[is.element(idat$exper, c('23H', '23I', '24E', '24F', '24G')), ]
# flux over time
ggplot(idat, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ trial) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggplot(idat.treat, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ new.ID) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggplot(idat.prop, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ trial) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggplot(idat.prop, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ new.ID) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/NH3.flux01.prop.png', height = 10, width = 10)
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('subset.R')
source('summary.R')
source('export.R')
idat.treat <- idat[is.element(idat$exper, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')), ]
idat.prop <- idat[is.element(idat$exper, c('23H', '23I', '24E', '24F', '24G')), ]
ggplot(idat.treat, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ new.ID) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/NH3.flux01.treat.png', height = 10, width = 10)
ggplot(idat.prop, aes(cta, j.NH3, group = pmid, color = treat)) +
geom_point() +
facet_wrap(~ new.ID) +
theme_bw() +
labs(x = 'Time after application (h)', y = expression('NH'[3]~'flux'~('kg N h'^'-1'~ha^'-1'))) +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/NH3.flux01.prop.png', height = 10, width = 10)
ggplot(idat.treat[idat.treat$treat == 'A' & idat.treat$rep == '1' | idat.treat$treat == '2-pos' & idat.treat$rep == '1' | idat.treat$treat == 'TS-TSB-4' & idat.treat$rep == '1' | idat.treat$treat == 'TH' & idat.treat$rep == '1' | idat.treat$treat == 'Un12' & idat.treat$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ new.ID, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = 'Air temperature (째C)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/temp.treat.png', height = 10, width = 10)
ggplot(idat.prop[idat.prop$treat == 'A' & idat.prop$rep == '1' | idat.prop$treat == '2-pos' & idat.prop$rep == '1' | idat.prop$treat == 'TS-TSB-4' & idat.prop$rep == '1' | idat.prop$treat == 'TH' & idat.prop$rep == '1' | idat.prop$treat == 'Un12' & idat.prop$rep == '1', ],
aes(cta, air.temp, group = pmid)) +
geom_line() +
facet_wrap(~ new.ID, scales = 'free_x') +
theme_bw() +
labs(x = 'Time after application (h)', y = 'Air temperature (째C)') +
theme(legend.position = 'bottom', legend.title = element_blank()) +
xlim(NA, 150)
ggsave2x('../plots-meas/temp.prop.png', height = 10, width = 10)
esumm.treat.sup <- esumm[is.element(idat$exper, c('24B', '24H', '24A', '24I', '24K')), c('trial', 'treat', 'e.rel.150', 'e.rel.150.sd', 'e.rel.150.n')]
View(esumm.treat.sup)
# Select some cols from esumm to export
esumm.treat <- esumm[is.element(esumm$exper, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')), c('trial', 'treat', 'e.rel.150', 'e.rel.150.sd', 'e.rel.150.n')]
esumm.treat.sup <- esumm[is.element(esumm$exper, c('24B', '24H', '24A', '24I', '24K')), c('trial', 'treat', 'e.rel.150', 'e.rel.150.sd', 'e.rel.150.n')]
esumm.prop <- esumm[is.element(esumm$exper, c('23H', '23I', '24E', '24F', '24G')), c('trial', 'treat', 'e.rel.150', 'e.rel.150.sd', 'e.rel.150.n')]
View(esumm)
# Select some cols from esumm to export
esumm.treat <- esumm[is.element(esumm$trial, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')), c('trial', 'treat', 'e.rel.150', 'e.rel.150.sd', 'e.rel.150.n')]
esumm.treat.sup <- esumm[is.element(esumm$trial, c('24B', '24H', '24A', '24I', '24K')), c('trial', 'treat', 'e.rel.150', 'e.rel.150.sd', 'e.rel.150.n')]
esumm.prop <- esumm[is.element(esumm$trial, c('23H', '23I', '24E', '24F', '24G')), c('trial', 'treat', 'e.rel.150', 'e.rel.150.sd', 'e.rel.150.n')]
View(esumm.prop)
View(esumm.treat)
View(esumm.treat.sup)
write.csv(esumm.treat, '../output/cum.emis.treat.csv', row.names = FALSE)
write.csv(esumm.treat.sup, '../output/cum.emis.treat.sup.csv', row.names = FALSE)
write.csv(esumm.prop, '../output/cum.emis.prop.csv', row.names = FALSE)
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/scripts-pub-tables")
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
# Summarizes data
# converting digestate properties from character to numeric
sapply(dig.dat, class)
cols <- c('amount', 'dublicate', 'TS', 'VS', 'mm2', 'mm2TS', 'density', 'K', 'n', 'r2', 'ammonium.N.A', 'totN', 'pH.lab', 'pH.field')
dig.dat[, (cols) := lapply(.SD, as.numeric), .SDcols = cols]
# Mean and sd of digestate properties
dsumm <- dig.dat[ , list(
amount.mn = mean(amount),
TS.mn = mean(TS), TS.sd = sd(TS), TS.n = length(TS),
VS.mn = mean(VS), VS.sd = sd(VS), VS.n = length(VS),
mm2.mn = mean(mm2), mm2.sd = sd(mm2), mm2.n = length(mm2),
mm2TS.mn = mean(mm2TS), mm2TS.sd = sd(mm2TS), mm2TS.n = length(mm2TS),
density.mn = mean(density), desnity.n = length(density),
K.mn = mean(K), K.n = length(K),
n.mn = mean(n), n.n = length(n),
r2.mn = mean(r2),
NH4.mn = mean(ammonium.N.A), NH4.sd = sd(ammonium.N.A), ammonium.N.A.n = length(ammonium.N.A),
totN.mn = mean(totN), totN.sd = sd(totN), totN.n = length(totN),
pH.lab.mn = mean(pH.lab), pH.lab.sd = sd(pH.lab), pH.lab.n = length(pH.lab),
pH.field.mn = mean(pH.field), pH.field.sd = sd(pH.field), pH.field.n = length(pH.field)
), by = list(experiment, dig, straw, treat, acid)]
# changing TAN and totN from mg/kg to g/kg
cols <- c('totN.mn', 'totN.sd', 'NH4.mn', 'NH4.sd')
dsumm[, (cols) := lapply(.SD, function(x) x / 1000), .SDcols = cols]
# calculating app amount
dsumm$app.rate.mn <- dsumm$NH4.mn * dsumm$amount.mn
dsumm$app.rate.sd <- dsumm$NH4.sd * dsumm$amount.mn
sig2 <- c('amount.mn', 'app.rate.mn', 'app.rate.sd', 'NH4.mn', 'NH4.sd', 'totN.mn', 'totN.sd', 'pH.lab.mn', 'pH.lab.sd', 'pH.field.mn', 'pH.field.sd')
sig3 <- c('TS.mn', 'TS.sd', 'mm2.mn', 'mm2.sd', 'mm2TS.mn', 'mm2TS.sd', 'density.mn', 'r2.mn')
sig4 <- c('VS.mn', 'VS.sd', 'K.mn', 'n.mn')
dsumm <- as.data.frame(dsumm)
dsumm[, sig2] <- rounddf(dsumm[, sig2], digits = 2, func = signif)
dsumm[, sig3] <- rounddf(dsumm[, sig3], digits = 3, func = signif)
dsumm[, sig4] <- rounddf(dsumm[, sig4], digits = 4, func = signif)
# New ID's for treatment publication
dsumm$new.ID <- dsumm$experiment
dsumm$new.ID <- gsub('23C', '1', dsumm$new.ID)
dsumm$new.ID <- gsub('23D', '2', dsumm$new.ID)
dsumm$new.ID <- gsub('23G', '3', dsumm$new.ID)
dsumm$new.ID <- gsub('24M', '4', dsumm$new.ID)
dsumm$new.ID <- gsub('24B', '5', dsumm$new.ID)
dsumm$new.ID <- gsub('24H', '6', dsumm$new.ID)
dsumm$new.ID <- gsub('24C', '7', dsumm$new.ID)
dsumm$new.ID <- gsub('24D', '8', dsumm$new.ID)
dsumm$new.ID <- gsub('24J', '9', dsumm$new.ID)
dsumm$new.ID <- gsub('24L', '10', dsumm$new.ID)
dsumm$new.ID <- gsub('24N', '11', dsumm$new.ID)
dsumm$new.ID <- gsub('24O', '12', dsumm$new.ID)
dsumm$new.ID <- gsub('24A', '13', dsumm$new.ID)
dsumm$new.ID <- gsub('24I', '14', dsumm$new.ID)
dsumm$new.ID <- gsub('24K', '15', dsumm$new.ID)
# New ID's for properties publication
dsumm$new.ID <- gsub('23H', '1', dsumm$new.ID)
dsumm$new.ID <- gsub('23I', '2', dsumm$new.ID)
dsumm$new.ID <- gsub('24E', '3', dsumm$new.ID)
dsumm$new.ID <- gsub('24F', '4', dsumm$new.ID)
dsumm$new.ID <- gsub('24G', '5', dsumm$new.ID)
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('summary_dig.R')
source('summary_ESA.R')
source('summary_soil.R')
source('export.R')
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('summary_dig.R')
source('summary_ESA.R')
source('summary_soil.R')
# Combinding ESA data with digestate properties data
colnames(Esumm)[which(names(Esumm) == 'treat')] <- 'dig'
dsumm <- merge(dsumm, Esumm, by = c('experiment', 'dig'), all.x = TRUE)
# Digestate properties
dsumm$TS <- paste(dsumm$TS.mn, ' 짹 ', dsumm$TS.sd)
dsumm$VS <- paste(dsumm$VS.mn, ' 짹 ', dsumm$VS.sd)
dsumm$ESA <- paste(dsumm$area.perc.mn, ' 짹 ', dsumm$area.perc.sd)
dsumm$mm2 <- paste(dsumm$mm2.mn, ' 짹 ', dsumm$mm2.sd)
dsumm$mm2TS <- paste(dsumm$mm2TS.mn, ' 짹 ', dsumm$mm2TS.sd)
dsumm$NH4 <- paste(dsumm$NH4.mn, ' 짹 ', dsumm$NH4.sd)
dsumm$totN <- paste(dsumm$totN.mn, ' 짹 ', dsumm$totN.sd)
dsumm$pH.lab <- paste(dsumm$pH.lab.mn, ' 짹 ', dsumm$pH.lab.sd)
dsumm$pH.field <- paste(dsumm$pH.field.mn, ' 짹 ', dsumm$pH.field.sd)
# Select some cols from esumm to export
# Paper on digestate application and treatment:
dsumm.treat1 <- dsumm[is.element(dsumm$experiment, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')),
c('new.ID', 'dig', 'straw', 'treat', 'TS', 'VS', 'NH4', 'totN', 'pH.lab', 'pH.field', 'amount.mn', 'app.rate.mn')]
dsumm.treat2 <- dsumm[is.element(dsumm$experiment, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')),
c('new.IDt', 'dig', 'straw', 'treat', 'density.mn', 'mm2', 'mm2TS', 'K.mn', 'n.mn')]
dsumm.treat2 <- dsumm[is.element(dsumm$experiment, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')),
c('new.ID', 'dig', 'straw', 'treat', 'density.mn', 'mm2', 'mm2TS', 'K.mn', 'n.mn')]
# Paper on digestate properties:
dsumm.prop <- dsumm[is.element(dsumm$experiment, c('23H', '23I', '24E', '24F', '24G')),
c('new.ID', 'dig', 'straw', 'treat', 'TS', 'VS', 'density.mn', 'mm2', 'mm2TS',
'K.mn', 'n.mn', 'ESA', 'NH4', 'totN', 'pH.lab', 'pH.field', 'amount.mn', 'app.rate.mn')]
write.csv(dsumm.treat1, '../output/digestate.table.treat1.csv', row.names = FALSE)
write.csv(dsumm.treat2, '../output/digestate.table.treat2.csv', row.names = FALSE)
write.csv(dsumm.prop, '../output/digestate.table.prop.csv', row.names = FALSE)
# Temperature
temp.dat$temp.mean <- paste(temp.dat$air.temp.mean, '(', temp.dat$air.temp.min, ',', temp.dat$air.temp.max,')')
colnames(temp.dat)[which(names(temp.dat) == 'trial')] <- 'experiment'
# Soil data
ssumm$water <- paste(ssumm$water.mn, ' 짹 ', ssumm$water.sd)
ssumm$bulk <- paste(ssumm$bulk.mn, ' 짹 ', ssumm$bulk.sd)
stsumm <- merge(temp.dat, ssumm, by = c('experiment'))
stsumm.treat <- stsumm[is.element(stsumm$experiment, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')),
c('new.ID', 'water', 'bulk', 'pH', 'crop.height', 'air.temp.start', 'temp.mean')]
stsumm.prop <- stsumm[is.element(stsumm$experiment, c('23H', '23I', '24E', '24F', '24G')),
c('new.ID', 'water', 'bulk', 'pH', 'crop.height', 'air.temp.start', 'temp.mean')]
write.csv(stsumm.treat, '../output/soil.table.treat.csv', row.names = FALSE)
write.csv(stsumm.prop, '../output/soil.table.prop.csv', row.names = FALSE)
# Column with measurement duration
dt.treat <- stsumm[is.element(stsumm$experiment, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')),
c('new.ID', 'dt')]
dt.prop <- stsumm[is.element(stsumm$experiment, c('23H', '23I', '24E', '24F', '24G')),
c('new.ID', 'dt')]
write.csv(dt.treat, '../output/dt.treat.csv', row.names = FALSE)
write.csv(dt.prop, '../output/dt.prop.csv', row.names = FALSE)
setwd("C:/Users/au583430/OneDrive - Aarhus universitet/Documents/GitHub/Pedersen-2024-MAG/scripts-pub-tables")
rm(list = ls())
source('functions.R')
source('packages.R')
source('load.R')
source('summary_dig.R')
source('summary_ESA.R')
source('summary_soil.R')
# Combinding ESA data with digestate properties data
colnames(Esumm)[which(names(Esumm) == 'treat')] <- 'dig'
dsumm <- merge(dsumm, Esumm, by = c('experiment', 'dig'), all.x = TRUE)
# Digestate properties
dsumm$TS <- paste(dsumm$TS.mn, ' 짹 ', dsumm$TS.sd)
dsumm$VS <- paste(dsumm$VS.mn, ' 짹 ', dsumm$VS.sd)
dsumm$ESA <- paste(dsumm$area.perc.mn, ' 짹 ', dsumm$area.perc.sd)
dsumm$mm2 <- paste(dsumm$mm2.mn, ' 짹 ', dsumm$mm2.sd)
dsumm$mm2TS <- paste(dsumm$mm2TS.mn, ' 짹 ', dsumm$mm2TS.sd)
dsumm$NH4 <- paste(dsumm$NH4.mn, ' 짹 ', dsumm$NH4.sd)
dsumm$totN <- paste(dsumm$totN.mn, ' 짹 ', dsumm$totN.sd)
dsumm$pH.lab <- paste(dsumm$pH.lab.mn, ' 짹 ', dsumm$pH.lab.sd)
dsumm$pH.field <- paste(dsumm$pH.field.mn, ' 짹 ', dsumm$pH.field.sd)
# Select some cols from esumm to export
# Paper on digestate application and treatment:
dsumm.treat1 <- dsumm[is.element(dsumm$experiment, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')),
c('new.ID', 'dig', 'straw', 'treat', 'TS', 'VS', 'NH4', 'totN', 'pH.lab', 'pH.field', 'amount.mn', 'app.rate.mn')]
dsumm.treat2 <- dsumm[is.element(dsumm$experiment, c('23C', '23D', '23G', '24M', '24B', '24C', '24D', '24H', '24J', '24L', '24N', '24O')),
c('new.ID', 'dig', 'straw', 'treat', 'density.mn', 'mm2', 'mm2TS', 'K.mn', 'n.mn')]
# Paper on digestate properties:
dsumm.prop <- dsumm[is.element(dsumm$experiment, c('23H', '23I', '24E', '24F', '24G')),
c('new.ID', 'dig', 'straw', 'treat', 'TS', 'VS', 'density.mn', 'mm2', 'mm2TS',
'K.mn', 'n.mn', 'ESA', 'NH4', 'totN', 'pH.lab', 'pH.field', 'amount.mn', 'app.rate.mn')]
write.csv(dsumm.treat1, '../output/digestate.table.treat1.csv', row.names = FALSE, fileEncoding = 'utf-8')
